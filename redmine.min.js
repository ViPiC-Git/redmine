/* 0.1.1d взаимодействие с redmine по средствам api

cscript redmine.min.js <url> <key> <method> [... <param>]
cscript redmine.min.js <url> <key> users.sync <fields> [<container>] [<auth>]
cscript redmine.min.js <url> <key> issues.change [<query>] <fields> [<filters>]

<url>               - базовый url адрес для запросов к api
<key>               - ключ доступа к api для взаимодействия
<method>            - собственный метод который нужно выполнить
    users.sync      - синхранизация пользователей из ldap
        <fields>    - id поля и имени аттрибута LDAP в формате id:name#format;id:name
        <container> - контейнер пользователей в LDAP
        <auth>      - id режима аутентификации в приложении
    issues.change   - изменение задач в сохранённом запросе
        <query>     - id сохранённого запроса для всех проектов
        <fields>    - поля и их значения в формате id:value;id:value с шаблонизацией
        <filters>   - фильтр в формате id:value;id:value с шаблонизацией

*/

// 0.3.15 конструктор основного приложения
function App(a){this.val=a};

// 0.1.3 библиотека функций общего назначения
(function(p,B){p.lib={strFirstUpperCase:function(a){return a.substr(0,1).toUpperCase()+a.substr(1)},clone:function(a){switch(!0){case p.lib.validate(a,"date"):var b=new Date(a);break;case p.lib.validate(a,"array"):b=[];for(var c=0,e=a.length;c<e;c++)b[c]=p.lib.clone(a[c]);break;case p.lib.validate(a,"object"):b={};for(c in a)b[c]="prototype"!==c?p.lib.clone(a[c]):a[c];break;default:b=a}return b},compare:function(a,b,c){var e=0;b||(b=null);switch(!0){case p.lib.validate(a,"string"):b=p.lib.convert(b,
"string");c&&(a=a.toLowerCase(),b=b.toLowerCase());break;case p.lib.validate(a,"array"):b=b&&b.length?b.length:0;a=a.length;break;case p.lib.validate(a,"date"):b=b&&b.valueOf()?b.valueOf():0,a=a.valueOf()}a>b&&(e=1);a<b&&(e=-1);return e},difference:function(a,b,c){var e;c||(c=p.lib.compare);if(p.lib.validate(a,"array")){b||(b=[]);for(var d=0,h=a.length;d<h;d++){var q=a[d];for(var g=0,m=b.length;g<m;g++){var k=b[g];if(value=c(q,k))e||(e=[]),e.push(q)}}}else if(p.lib.validate(a,"object"))for(d in b||
(b={}),a)q=a[d],k=b[d],value=p.lib.difference(q,k,c),p.lib.validate(value,"undefined")||(e||(e={}),e[d]=value);else(value=p.lib.compare(a,b))&&(e=a);return e},strim:function(a,b,c,e,d){var h="";a=a?a.toString():h;b=b?b.toString():h;c=c?c.toString():h;if(d){var q=c?a.lastIndexOf(c):a.length;d=b&&~q?a.lastIndexOf(b,q-1):0}else d=b?a.indexOf(b):0,q=c&&~d?a.indexOf(c,d+b.length):a.length;~d&&~q&&(d=e?d:d+b.length,q=e?q+c.length:q,h=a.substr(d,q-d));return h},trim:function(a){return(a||"").replace(/^\s+|\s+$/g,
"")},validate:function(a,b){var c;switch(b){case "email":b="^([a-z0-9_-]+.)*[a-z0-9_-]+@[a-z0-9_-]+(.[a-z0-9_-]+)*.[a-z]{2,6}$";break;case "password":b="(?=^.{8,}$)((?=.*d)|(?=.*W+))(?![.\n])(?=.*[A-Z])(?=.*[a-z]).*$";break;case "guid":b="^{[0-9a-fA-F]{8}(-[0-9a-fA-F]{4}){3}-[0-9a-fA-F]{12}}$";break;case "md5":b="^[0-9a-fA-F]{32}$"}switch(b){case "string":a="[object String]"===Object.prototype.toString.call(a);break;case "number":a="[object Number]"===Object.prototype.toString.call(a);break;case "boolean":a=
"[object Boolean]"===Object.prototype.toString.call(a);break;case "function":a="[object Function]"===Object.prototype.toString.call(a);break;case "form":a=!(!a||!a.tagName||"form"!==a.tagName.toLowerCase());break;case "files":a="[object FileList]"===Object.prototype.toString.call(a);break;case "date":a="[object Date]"===Object.prototype.toString.call(a);break;case "array":a=Array.isArray?Array.isArray(a):"[object Array]"===Object.prototype.toString.call(a);break;case "xml":a=!(!a||!(c=(a.ownerDocument||
a).documentElement)||"html"===c.nodeName.toLowerCase());break;case "undefined":a=void 0===a;break;case "null":a=null===a;break;case "object":a=a===Object(a)&&"[object Null]"!==Object.prototype.toString.call(a)&&"[object Date]"!==Object.prototype.toString.call(a)&&"[object Function]"!==Object.prototype.toString.call(a)&&"[object FileList]"!==Object.prototype.toString.call(a)&&"[object Array]"!==Object.prototype.toString.call(a)&&!(a&&(c=(a.ownerDocument||a).documentElement)&&"html"!==c.nodeName.toLowerCase())&&
!(a&&a.tagName&&"form"===a.tagName.toLowerCase());break;default:a=(new RegExp(b)).test(""+a)}return a},obj2str:function(a,b,c,e,d){var h=[];c||(c="&");e||(e="=");d||(d=",");for(var q in a){var g=a[q];var m=b?encodeURIComponent(q):q;switch(!0){case p.lib.validate(g,"array"):g=g.join(d);case !p.lib.validate(g,"undefined"):m+=e,m+=b?encodeURIComponent(g):g}h.push(m)}return h.join(c)},str2obj:function(a,b,c,e){var d,h={};c||(c="&");e||(e="=");c=a.split(c);for(var q=0,g=c.length;q<g;q++)if(d=c[q])d=d.split(e,
2),a=d[0],d=d[1],a=b?decodeURIComponent(a):a,d=b&&d?decodeURIComponent(d):d,h[a]=d;return h},url2obj:function(a){var b=a,c={},e=!1;a="fragment";var d="#";-1!=b.indexOf(d)&&(c[a]=p.lib.strim(b,d,null,!1),b=p.lib.strim(b,null,d,!1));a="query";d="?";-1!=b.indexOf(d)&&(c[a]=p.lib.strim(b,d,null,!1),b=p.lib.strim(b,null,d,!1));a="scheme";d="//";0==b.indexOf(d)&&(c[a]=p.lib.strim(b,null,d,!1),b=p.lib.strim(b,d,null,!1),e=!0);a="path";d="/";b.indexOf("://")>b.indexOf(d)&&(c[a]=p.lib.strim(b,d,null,!0),b=
p.lib.strim(b,null,d,!1));a="path";d="://";0==b.indexOf(d)&&(c[a]=p.lib.strim(b,d,null,!0),b=p.lib.strim(b,null,d,!1));a="scheme";d="://";!e&&0<b.indexOf(d)&&(c[a]=p.lib.strim(b,null,d,!1),b=p.lib.strim(b,d,null,!1),e=!0);a="path";d="/";e&&-1!=b.indexOf(d)&&(c[a]=p.lib.strim(b,d,null,!0),b=p.lib.strim(b,null,d,!1));a="path";d=b.length;!e&&0<d&&(c[a]=b,b="");d="@";if(-1!=b.indexOf(d)){var h=p.lib.strim(b,d,null,!1);b=p.lib.strim(b,null,d,!1);a="password";d=":";-1!=b.indexOf(d)&&(c[a]=p.lib.strim(b,
d,null,!1),b=p.lib.strim(b,null,d,!1));c.user=b;b=h}a="port";d=":";-1!=b.indexOf(d)&&(c[a]=p.lib.strim(b,d,null,!1),b=p.lib.strim(b,null,d,!1));e&&(c.domain=b);return c},obj2url:function(a){var b="";"user"in a&&(b="//");"password"in a&&(b="//");"domain"in a&&(b="//");"port"in a&&(b="//");var c="scheme";a[c]&&(b="://");var e=""+((a[c]?a[c]:"")+b);c="user";c in a&&(e+=""+a[c]);c="password";c in a&&(e+=":"+a[c]);b="";"user"in a&&(b="@");"password"in a&&(b="@");c="domain";e+=b+(a[c]?a[c]:"");c="port";
c in a&&(e+=":"+a[c]);c="path";c in a&&(e+=""+a[c]);c="query";c in a&&(e+="?"+a[c]);c="fragment";c in a&&(e+="#"+a[c]);return e},data2obj:function(a){var b={};a=a.split("\r\n");var c=a.shift().split("\t");for(var e=0;e<c.length;e++)c[e]=c[e].split(":"),c[e]={name:c[e][0],type:c[e][1]};e=0;for(var d=a.length;e<d;e++){var h=a[e].split("\t",c.length);var q={};for(var g=0;g<h.length;g++)q[c[g].name]=p.lib.convert(h[g],c[g].type);c[0]&&(b[q[c[0].name]]=q)}return b},obj2data:function(a){var b=[],c=[];split=
"\t";delim="\r\n";param=":";none=" ";for(var e in a){if(!b.length){var d=[];for(m in a[e]){var h=a[e][m];h="id"==m?"integer":p.lib.validate(h,"number")?"float":p.lib.validate(h,"boolean")?"boolean":p.lib.validate(h,"date")?"date":"string";b["id"==m?0:b.length]={name:m,type:h};d[d.length]=m+param+h}c[c.length]=d.join(split)}d=[];for(var q=0,g=b.length;q<g;q++){var m=b[q].name;h=a[e][m];for(h=p.lib.convert(h,"string");-1!=h.indexOf(split);)h=h.replace(split,none);for(;-1!=h.indexOf(delim);)h=h.replace(delim,
none);h=h.replace(/[\t\r\n]/g,none);d[d.length]=h}c[c.length]=d.join(split)}return c.join(delim)},obj2arr:function(a,b){var c=[];b||(b=function(a){return a});for(var e in a){var d=a[e];d=b(d,e,a);p.lib.validate(d,"undefined")||c.push(d)}return c},arr2obj:function(a,b,c){var e={};b||(b=function(a){return a});c||(c=function(a,b){return b});for(var d=0,h=a.length;d<h;d++){var q=a[d];var g=c(q,d,a);q=b(q,d,a);p.lib.validate(q,"undefined")||p.lib.validate(g,"undefined")||(e[g]=q)}return e},convert:function(a,
b){switch(b){case "bool":case "boolean":a="true"===a?!0:"false"===a?!1:!!a;break;case "int":case "integer":case "float":case "double":case "real":case "number":a=Number(a);break;case "date":a=new Date(1E3*Number(a));break;case "string":p.lib.validate(a,"boolean")?a=a?"true":"false":(p.lib.validate(a,"date")&&(a=a.valueOf()/1E3),a=a.toString())}return a},xhr:function(a,b,c,e,d,h,q,g){var m,k=6E5,n=0;var f=m={responseText:""};var z=null;if(!n){var t=a?""+a:"get";a=t.toUpperCase();switch(a.toLowerCase()){case "get":z=
!0;break;case "head":z=!0;break;case "delete":z=!0}}if(!n){var r=function(){};var u={upload:r,download:r,success:r,error:r,complete:r};if(p.lib.validate(h,"function"))u.complete=h;else if(h)for(v in u)r=h[v],p.lib.validate(r,"function")&&(u[v]=r);h=u}if(!n){u={"X-Requested-With":"XMLHttpRequest"};if(!1===c){var v="X-Requested-With";v in u&&delete u[v]}if(p.lib.validate(c,"object"))for(v in c)switch(r=c[v],v.toLowerCase()){case "cookie":break;case "host":break;default:u[v]=r}c=u}if(!n){e=e?e:"";if(p.lib.validate(e,
"form")){u={};for(var w=0,x=e.elements.length;w<x;w++)r=e.elements[w],r.name&&!r.disabled&&(v=(""+r.type).toLowerCase(),"checkbox"==v||"radio"==v?r.checked&&(u[r.name]=r.value?r.value:!0):u[r.name]=r.files&&r.files.length?r.files:r.value?r.value:B);e=u}p.lib.validate(e,"xml")&&(z=!1,c["Content-Type"]="application/xml",e.xml?e=e.xml:(u=new XMLSerializer,e=u.serializeToString(e)));if(p.lib.validate(e,"object")){u=!1;for(v in e)if(r=e[v],p.lib.validate(r,"files")){z=!1;u=!0;break}if(u)for(v in u=new FormData,
e)if(r=e[v],p.lib.validate(r,"files")){var y=e[v];w=0;for(x=y.length;w<x;w++)r=y[w],u.append(v,r)}else p.lib.validate(r,"undefined")&&(r=""),u.append(v,r);else e=p.lib.obj2str(e,!0),!z&&e&&(c["Content-Type"]="application/x-www-form-urlencoded")}}n||(t=b?""+b:"",z&&e&&(t=t?~t.indexOf("?")?t+"&":t+"?":t+"?",t+=e,e=""),b=t);if(!n){u=null;if(!u)try{u=new XMLHttpRequest}catch(A){}if(!u)for(z="$#!&%",y=["Ms$#!&%xm$#!&%l2$#!&%.XM$#!&%LHT$#!&%TP.6.0","Ms$#!&%xm$#!&%l2$#!&%.XM$#!&%LHT$#!&%TP.3.0","Ms$#!&%xm$#!&%l2$#!&%.XM$#!&%LHT$#!&%TP",
"Micr$#!&%osoft$#!&%.XM$#!&%LH$#!&%TTP"],w=0,x=y.length;!u&&w<x;w++){r=y[w];t=r.split(z).join("");try{u=new ActiveXObject(t)}catch(A){}}u?f=u:n=1}if(!n){try{k=setTimeout(function(){t=f.responseText?f.responseText:"";f.abort();h.error(t,f);h.complete(t,f)},k)}catch(A){}f.upload&&(f.upload.onprogress=function(a){a.total&&a.loaded!=a.total&&h.upload(a,f)},f.onprogress=function(a){a.total&&a.loaded!=a.total&&h.download(a,f)});f.onreadystatechange=function(a){if(4==f.readyState){try{clearTimeout(k)}catch(C){}v=
f.status?f.status:200;t=f.responseText?f.responseText:"";200<=v&&300>v&&t?h.success(t,f):h.error(t,f);h.complete(t,f)}}}if(!n)try{g?f.open(a,b,d,q,g):q?f.open(a,b,d,q):f.open(a,b,d)}catch(A){f=m,n=2}if(!n)for(v in c)t=c[v],z="; ",p.lib.validate(t,"array")&&(y=t,t=y.join(z)),f.setRequestHeader(v,t);if(!n)try{e?f.send(e):f.send()}catch(A){f=m,n=3}if(1<n)try{clearTimeout(k)}catch(A){}n&&(t="",h.error(t,f),h.complete(t,f));return f},ajax:function(a,b,c,e,d){return p.lib.xhr(a,b,c,e,!0,d)},sjax:function(a,
b,c,e){return p.lib.xhr(a,b,c,e,!1)},strPad:function(a,b,c,e){var d,h=d="",q=function(a,b){for(;h.length<b;)h+=a;return h=h.substr(0,b)};a=""+a;c=c?""+c:" ";"left"!=e&&"right"!=e&&"both"!=e&&(e="right");0<(d=b-a.length)&&("left"==e?a=q(c,d)+a:"right"==e?a+=q(c,d):"both"==e&&(d=q(c,Math.ceil(d/2)),a=(d+a+a).substr(0,b)));return a},getCookie:function(a,b){var c=document.cookie.indexOf(a+"="),e=c+a.length+1;if(!c&&a!=document.cookie.substring(0,a.length)||-1==c)return null;a=document.cookie.indexOf(";",
e);-1==a&&(a=document.cookie.length);return b?decodeURIComponent(document.cookie.substring(e,a)):unescape(document.cookie.substring(e,a))},setCookie:function(a,b,c,e,d,h,q){var g=new Date((new Date).valueOf()+c);document.cookie=a+"="+(q?encodeURIComponent(b):escape(b))+(c?";expires="+g.toGMTString():"")+(e?";path="+e:"")+(d?";domain="+d:"")+(h?";secure":"");return!0},delCookie:function(a,b,c){p.lib.getCookie(a)&&(document.cookie=a+"="+(b?";path="+b:"")+(c?";domain="+c:"")+";expires=Thu, 01-Jan-1970 00:00:01 GMT");
return!0},getStorage:function(a,b){var c,e=null,d=null;if(c=window&&window.localStorage?localStorage.getItem(a):p.lib.getCookie(a)){var h=c.indexOf("?");-1!=h&&(type=c.substr(0,h),c=c.substr(h+1));b?(c=c.split("&"),!0!==b&&(c.length=Math.min(b,c.length))):c=[c];for(var q=0,g=c.length;q<g;q++){h=c[q].indexOf("=");if(-1!=h){if(a=c[q].substr(0,h),a=decodeURIComponent(a),e=c[q].substr(h+1),!d){var m=!0;d={}}}else a=q,e=c[q],d||(m=!1,d=[]);e=decodeURIComponent(e);type&&(e=p.lib.convert(e,type));m?d[a]=
e:d.push(e)}}else d=null;return b?d:e},setStorage:function(a,b){var c,e=[];var d=function(a,b){c||(c=p.lib.validate(a,"number")?"number":p.lib.validate(a,"date")?"date":p.lib.validate(a,"boolean")?"boolean":"string");a=p.lib.convert(a,"string");a=encodeURIComponent(a);p.lib.validate(b,"undefined")?e.push(a):(b=encodeURIComponent(b),e.push(b+"="+a))};if(p.lib.validate(b,"object"))for(var h in b)d(b[h],h);else if(p.lib.validate(b,"array")){h=0;for(var q=b.length;h<q;h++)d(b[h])}else p.lib.validate(b,
"null")||d(b);if(e=e.join("&"))if(e=c+"?"+e,window&&window.localStorage)try{localStorage.setItem(a,e);var g=!0}catch(m){g=!1}else g=p.lib.setCookie(a,e,31536E7,location.pathname,document.domain);else window&&window.localStorage?(localStorage.removeItem(a),g=!0):g=p.lib.delCookie(a,location.pathname,document.domain);return g},counter:function(){var a={};return function(b,c){var e=0;p.lib.validate(b,"array")&&b.join("_");b&&(a[b]=a[b]||0,e=a[b],!1===c?delete a[b]:!0===c?a[b]++:c&&(a[b]+=c));return e}}(),
on:function(){var a={};return function(b,c,e){var d,h=[],q=0;b=b.toString().split(/\s+/);for(var g=0,m=b.length;g<m;g++)if(d=b[g])if(a[d]||(a[d]=[0]),e)if(c){a[d][c]||(a[d][c]=[]);var k=a[d][c].length;a[d][c][k]=e;a[d][0]>=c&&h.push([d,c,k]);q++}else{k=1;for(var n=a[d].length;k<n;k++)if(a[d][k])for(var f=0,p=a[d][k].length;f<p;f++)a[d][k][f]===e&&(delete a[d][k][f],q++)}else if(a[d][0]++,c=c||a[d][0],a[d][c])for(k=0;k<a[d][c].length;k++)a[d][c][k]&&h.push([d,c,k]),q++;g=0;for(m=h.length;g<m;g++)d=
h[g][0],c=h[g][1],k=h[g][2],a[d]&&a[d][c]&&a[d][c][k]&&a[d][c][k].call(a[d][c][k],c);return q}}(),href:function(a){var b=document.createElement("a");b.href=a;return b.cloneNode(!1).href},getExt:function(a){var b="";var c=(""+a).lastIndexOf(".");-1!==c&&(b=a.substr(c+1),b=b.toLowerCase());return b},md5:function(a){var b=function(a,b){var c=a&2147483648;var d=b&2147483648;var e=a&1073741824;var g=b&1073741824;a=(a&1073741823)+(b&1073741823);return e&g?a^2147483648^c^d:e|g?a&1073741824?a^3221225472^
c^d:a^1073741824^c^d:a^c^d},c=function(a,c,d,e,g,h,f){a=b(a,b(b(c&d|~c&e,g),f));return b(a<<h|a>>>32-h,c)},e=function(a,c,d,e,g,h,f){a=b(a,b(b(c&e|d&~e,g),f));return b(a<<h|a>>>32-h,c)},d=function(a,c,d,e,g,h,f){a=b(a,b(b(c^d^e,g),f));return b(a<<h|a>>>32-h,c)},h=function(a,c,d,e,g,h,f){a=b(a,b(b(d^(c|~e),g),f));return b(a<<h|a>>>32-h,c)},q=function(a){var b="",c;for(c=0;3>=c;c++){var d=a>>>8*c&255;d="0"+d.toString(16);b+=d.substr(d.length-2,2)}return b},g=[];a=function(a){a=a.replace(/\r\n/g,"\n");
for(var b="",c=0;c<a.length;c++){var d=a.charCodeAt(c);128>d?b+=String.fromCharCode(d):(127<d&&2048>d?b+=String.fromCharCode(d>>6|192):(b+=String.fromCharCode(d>>12|224),b+=String.fromCharCode(d>>6&63|128)),b+=String.fromCharCode(d&63|128))}return b}(a.toString());g=function(a){var b=a.length;var c=b+8;for(var d=16*((c-c%64)/64+1),e=Array(d-1),g,h=0;h<b;)c=(h-h%4)/4,g=h%4*8,e[c]|=a.charCodeAt(h)<<g,h++;c=(h-h%4)/4;e[c]|=128<<h%4*8;e[d-2]=b<<3;e[d-1]=b>>>29;return e}(a);var m=1732584193;var k=4023233417;
var n=2562383102;var f=271733878;for(a=0;a<g.length;a+=16){var p=m;var t=k;var r=n;var u=f;m=c(m,k,n,f,g[a+0],7,3614090360);f=c(f,m,k,n,g[a+1],12,3905402710);n=c(n,f,m,k,g[a+2],17,606105819);k=c(k,n,f,m,g[a+3],22,3250441966);m=c(m,k,n,f,g[a+4],7,4118548399);f=c(f,m,k,n,g[a+5],12,1200080426);n=c(n,f,m,k,g[a+6],17,2821735955);k=c(k,n,f,m,g[a+7],22,4249261313);m=c(m,k,n,f,g[a+8],7,1770035416);f=c(f,m,k,n,g[a+9],12,2336552879);n=c(n,f,m,k,g[a+10],17,4294925233);k=c(k,n,f,m,g[a+11],22,2304563134);m=c(m,
k,n,f,g[a+12],7,1804603682);f=c(f,m,k,n,g[a+13],12,4254626195);n=c(n,f,m,k,g[a+14],17,2792965006);k=c(k,n,f,m,g[a+15],22,1236535329);m=e(m,k,n,f,g[a+1],5,4129170786);f=e(f,m,k,n,g[a+6],9,3225465664);n=e(n,f,m,k,g[a+11],14,643717713);k=e(k,n,f,m,g[a+0],20,3921069994);m=e(m,k,n,f,g[a+5],5,3593408605);f=e(f,m,k,n,g[a+10],9,38016083);n=e(n,f,m,k,g[a+15],14,3634488961);k=e(k,n,f,m,g[a+4],20,3889429448);m=e(m,k,n,f,g[a+9],5,568446438);f=e(f,m,k,n,g[a+14],9,3275163606);n=e(n,f,m,k,g[a+3],14,4107603335);
k=e(k,n,f,m,g[a+8],20,1163531501);m=e(m,k,n,f,g[a+13],5,2850285829);f=e(f,m,k,n,g[a+2],9,4243563512);n=e(n,f,m,k,g[a+7],14,1735328473);k=e(k,n,f,m,g[a+12],20,2368359562);m=d(m,k,n,f,g[a+5],4,4294588738);f=d(f,m,k,n,g[a+8],11,2272392833);n=d(n,f,m,k,g[a+11],16,1839030562);k=d(k,n,f,m,g[a+14],23,4259657740);m=d(m,k,n,f,g[a+1],4,2763975236);f=d(f,m,k,n,g[a+4],11,1272893353);n=d(n,f,m,k,g[a+7],16,4139469664);k=d(k,n,f,m,g[a+10],23,3200236656);m=d(m,k,n,f,g[a+13],4,681279174);f=d(f,m,k,n,g[a+0],11,3936430074);
n=d(n,f,m,k,g[a+3],16,3572445317);k=d(k,n,f,m,g[a+6],23,76029189);m=d(m,k,n,f,g[a+9],4,3654602809);f=d(f,m,k,n,g[a+12],11,3873151461);n=d(n,f,m,k,g[a+15],16,530742520);k=d(k,n,f,m,g[a+2],23,3299628645);m=h(m,k,n,f,g[a+0],6,4096336452);f=h(f,m,k,n,g[a+7],10,1126891415);n=h(n,f,m,k,g[a+14],15,2878612391);k=h(k,n,f,m,g[a+5],21,4237533241);m=h(m,k,n,f,g[a+12],6,1700485571);f=h(f,m,k,n,g[a+3],10,2399980690);n=h(n,f,m,k,g[a+10],15,4293915773);k=h(k,n,f,m,g[a+1],21,2240044497);m=h(m,k,n,f,g[a+8],6,1873313359);
f=h(f,m,k,n,g[a+15],10,4264355552);n=h(n,f,m,k,g[a+6],15,2734768916);k=h(k,n,f,m,g[a+13],21,1309151649);m=h(m,k,n,f,g[a+4],6,4149444226);f=h(f,m,k,n,g[a+11],10,3174756917);n=h(n,f,m,k,g[a+2],15,718787259);k=h(k,n,f,m,g[a+9],21,3951481745);m=b(m,p);k=b(k,t);n=b(n,r);f=b(f,u)}return(q(m)+q(k)+q(n)+q(f)).toLowerCase()},sha256:function(a){var b=function(a,b){var c=(a&65535)+(b&65535);return(a>>16)+(b>>16)+(c>>16)<<16|c&65535},c=function(a,b){return a>>>b|a<<32-b};a=function(a){a=a.replace(/\r\n/g,"\n");
for(var b="",c=0;c<a.length;c++){var e=a.charCodeAt(c);128>e?b+=String.fromCharCode(e):(127<e&&2048>e?b+=String.fromCharCode(e>>6|192):(b+=String.fromCharCode(e>>12|224),b+=String.fromCharCode(e>>6&63|128)),b+=String.fromCharCode(e&63|128))}return b}(a);return function(a){for(var b="",c=0;c<4*a.length;c++)b+="0123456789abcdef".charAt(a[c>>2]>>8*(3-c%4)+4&15)+"0123456789abcdef".charAt(a[c>>2]>>8*(3-c%4)&15);return b}(function(a,d){var e=[1116352408,1899447441,3049323471,3921009573,961987163,1508970993,
2453635748,2870763221,3624381080,310598401,607225278,1426881987,1925078388,2162078206,2614888103,3248222580,3835390401,4022224774,264347078,604807628,770255983,1249150122,1555081692,1996064986,2554220882,2821834349,2952996808,3210313671,3336571891,3584528711,113926993,338241895,666307205,773529912,1294757372,1396182291,1695183700,1986661051,2177026350,2456956037,2730485921,2820302411,3259730800,3345764771,3516065817,3600352804,4094571909,275423344,430227734,506948616,659060556,883997877,958139571,
1322822218,1537002063,1747873779,1955562222,2024104815,2227730452,2361852424,2428436474,2756734187,3204031479,3329325298],q=[1779033703,3144134277,1013904242,2773480762,1359893119,2600822924,528734635,1541459225],g=Array(64),m,k;a[d>>5]|=128<<24-d%32;a[(d+64>>9<<4)+15]=d;for(m=0;m<a.length;m+=16){d=q[0];var n=q[1];var f=q[2];var p=q[3];var t=q[4];var r=q[5];var u=q[6];var v=q[7];for(k=0;64>k;k++){if(16>k)g[k]=a[k+m];else{var w=k;var x=g[k-2];x=c(x,17)^c(x,19)^x>>>10;x=b(x,g[k-7]);var y=g[k-15];y=
c(y,7)^c(y,18)^y>>>3;g[w]=b(b(x,y),g[k-16])}w=t;w=c(w,6)^c(w,11)^c(w,25);w=b(b(b(b(v,w),t&r^~t&u),e[k]),g[k]);v=d;v=c(v,2)^c(v,13)^c(v,22);x=b(v,d&n^d&f^n&f);v=u;u=r;r=t;t=b(p,w);p=f;f=n;n=d;d=b(w,x)}q[0]=b(d,q[0]);q[1]=b(n,q[1]);q[2]=b(f,q[2]);q[3]=b(p,q[3]);q[4]=b(t,q[4]);q[5]=b(r,q[5]);q[6]=b(u,q[6]);q[7]=b(v,q[7])}return q}(function(a){for(var b=[],c=0;c<8*a.length;c+=8)b[c>>5]|=(a.charCodeAt(c/8)&255)<<24-c%32;return b}(a),8*a.length))},parseJSON:function(a){if(window&&window.JSON&&JSON.parse)try{var b=
JSON.parse(a)}catch(c){b=eval("("+a+")")}else b=eval("("+a+")");return b},numDeclin:function(a,b,c,e){a=Number(a);a=Math.abs(a);a=Math.floor(a);var d=a%10;return 1!=(a%100-d)/10?0==d?b:1==d?c:5>d?e:b:b},num2str:function(a,b,c,e){var d,h;isNaN(b=Math.abs(b))&&(b=2);c==B&&(c=",");e==B&&(e=".");if(h=0>a)a=Math.abs(a);var q=parseInt(a=(+a||0).toFixed(b))+"";var g=(d=3<(d=q.length)?d%3:0)?q.substr(0,d)+e:"";e=q.substr(d).replace(/(\d{3})(?=\d)/g,"$1"+e);a=b?c+Math.abs(a-q).toFixed(b).replace(/-/,0).slice(2):
"";return(h?"-":"")+g+e+a},num2word:function(a,b,c){function e(a,b){a=a.toString().substr(-2);return b[0]+(/^[0,2-9]?[1]$/.test(a)?b[2]:/^[0,2-9]?[2-4]$/.test(a)?b[3]:b[1])}var d=[],h=[["ноль"],[,,,"три","четыре","пять","шесть","семь","восемь","девять"],"десять одиннадцать двенадцать тринадцать четырнадцать пятнадцать шестнадцать семнадцать восемнадцать девятнадцать".split(" "),[,,"двадцать","тридцать","сорок","пятьдесят","шестьдесят","семьдесят","восемьдесят","девяносто"],[,"сто","двести","триста",
"четыреста","пятьсот","шестьсот","семьсот","восемьсот","девятьсот"],[[,"один","два"],[,"одна","две"],[,"одно","два"]]],q=[["...ллион","ов","","а"],["тысяч","","а","и"],["миллион","ов","","а"],["миллиард","ов","","а"],["триллион","ов","","а"],["квадриллион","ов","","а"],["квинтиллион","ов","","а"],["секстилион","ов","","а"],["септилион","ов","","а"],["окталион","ов","","а"],["ноналион","ов","","а"],["декалион","ов","","а"],["эндекалион","ов","","а"],["додекалион","ов","","а"]],g=[[["цел","ых","ый",
"ых"],["цел","ых","ая","ых"],["цел","ых","ое","ых"]],["десят","ых","ая","ых"],["сот","ых","ая","ых"],["тясячн","ых","ая","ых"],["десятитысячн","ых","ая","ых"],["стотысячн","ых","ая","ых"],["милионн","ых","ая","ых"],["десятимилионн","ых","ая","ых"]];c=c||0;a=a.toString().split(".");for(var m=0,k=a.length;m<k;m++){m&&(a[m]=a[m].substr(0,g.length-1));l=a[m].length;a[m]=["","00","0"][a[m].split(/\d{3}/).join("").length]+a[m];for(var n=a[m].length,f,p=0,t=-1,r=[];3*p<n;){f=a[m].substr(-3*(p+1),3);r[++t]=
[];for(var u=0;2>=u;u++)if(0!=f[u])switch(u){case 0:r[t][r[t].length]=h[4][f[u]];break;case 1:1==f[u]?(r[t][r[t].length]=h[2][f[2]],u=3):r[t][r[t].length]=h[3][f[u]];break;case 2:r[t][r[t].length]=2>=f[u]?h[5][1==p||m?1:c][f[u]]:h[1][f[u]]}r[t].length||(r[t][r[t].length]=h[0][0]);0<f&&0<p&&(r[t][r[t].length]=e(f,q[p]));!p&&1<k&&(r[t][r[t].length]=e(f,m?g[l]:g[0][c]));p||!b||m||m!=k-1?!p&&b&&m&&(r[t][r[t].length]=b[0]+b[3]):r[t][r[t].length]=e(f,b);r[t]=r[t].join(" ");p++}d[d.length]=r.reverse().join(" ")}return d.join(" ")},
date2str:function(a,b){var c="Воскресенье Понедельник Вторник Среда Четверг Пятница Суббота".split(" "),e=" Января Февраля Марта Апреля Мая Июня Июля Августа Сентября Октября Ноября Декабря".split(" "),d={0:"ый",2:"ой",3:"ий",6:"ой",7:"ой",8:"ой",22:"ой",26:"ой",27:"ой",28:"ой"},h={"-660":"ST","-600":"HAST","-540":"AKT","-480":"AWST","-420":"CXT","-360":"СST","-300":"EST","-240":"AST","-210":"NST","-180":"ART",0:"GMT",60:"CET",120:"CAT",180:"MSK",210:"IRST",300:"PKT",330:"IST",360:"BDT",390:"MST",
420:"CXT",480:"AWST",540:"JST",570:"ACST",600:"AEST",660:"NFT"},q="";var g=function(b){var f="";switch(b){case "d":f+=p.lib.strPad(g("j"),2,"0","left");break;case "D":f+=g("l").substr(0,3);break;case "j":f+=a.getDate();break;case "l":f+=c[g("w")];break;case "N":f+=g("w")||7;break;case "S":f+=d[g("j")]||d[0];break;case "w":f+=a.getDay();break;case "z":f+=(a-new Date(a.getFullYear(),0,1))/864E5>>0;break;case "W":b=new Date(a.valueOf());var k=(a.getDay()+6)%7;b.setDate(b.getDate()-k+3);k=b.valueOf();
b.setMonth(0,1);4!==b.getDay()&&b.setMonth(0,1+(4-b.getDay()+7)%7);f+=1+Math.ceil((k-b)/6048E5);break;case "F":f+=e[g("n")];break;case "m":f+=p.lib.strPad(g("n"),2,"0","left");break;case "M":f+=g("F").substr(0,3);break;case "n":f+=a.getMonth()+1;break;case "t":f+=(new Date(a.getFullYear(),a.getMonth()+1,0)).getDate();break;case "L":f+=a.getFullYear()&3||!(a.getFullYear()%100)&&a.getFullYear()%400?0:1;break;case "o":(function(){var b=new Date(a.valueOf());b.setDate(b.getDate()-(a.getDay()+6)%7+3);
f+=b.getFullYear()})();break;case "Y":f+=a.getFullYear();break;case "y":f+=g("Y").substr(2,2);break;case "a":f+=11<a.getHours()?"pm":"am";break;case "A":f+=g("a").toUpperCase();break;case "B":(function(){var b=60*(a.getTimezoneOffset()+60);b=3600*a.getHours()+60*a.getMinutes()+a.getSeconds()+b;b=Math.floor(b/86.4);1E3<b&&(b-=1E3);0>b&&(b+=1E3);f+=p.lib.strPad(b,3,"0","left")})();break;case "g":f+=a.getHours()%12||12;break;case "G":f+=a.getHours();break;case "h":f+=p.lib.strPad(g("g"),2,"0","left");
break;case "H":f+=p.lib.strPad(g("G"),2,"0","left");break;case "i":f+=p.lib.strPad(a.getMinutes(),2,"0","left");break;case "s":f+=p.lib.strPad(a.getSeconds(),2,"0","left");break;case "u":f+=p.lib.strPad(1E3*a.getMilliseconds(),6,"0","left");break;case "e":f+=(new Date).toString().split(" ")[5].split("-")[0].split("+")[0];break;case "I":f+=(new Date(a.getFullYear(),0,1)).getTimezoneOffset()!=a.getTimezoneOffset()?1:0;break;case "O":f+=(0<a.getTimezoneOffset()?"-":"+")+p.lib.strPad(Math.abs(a.getTimezoneOffset()/
60*100),4,"0","left");break;case "P":f+=g("O").substr(0,3)+":"+g("O").substr(3,2);break;case "T":f+=h[-1*a.getTimezoneOffset()-60*Number(g("I"))]||h[0];break;case "Z":f+=-60*a.getTimezoneOffset();break;case "c":f+=g("Y")+"-"+g("m")+"-"+g("d")+"T"+g("h")+":"+g("i")+":"+g("s")+g("P");break;case "r":f+=g("D")+", "+g("j")+" "+g("M")+" "+g("Y")+" "+g("h")+":"+g("i")+":"+g("s")+" "+g("O");break;case "U":f+=Math.round(a.getTime()/1E3)}return f};for(var m=0,k=b.length;m<k;m++){var n=b.charAt(m);q="\\"!==
f?q+(g(n)||n):q+n;var f=n}return q},extend:function(){var a=arguments[0]||{},b=1,c=arguments.length,e=!1,d;p.lib.validate(a,"boolean")&&(e=a,a=arguments[1]||{},b=2);for(p.lib.validate(a,"object")||p.lib.validate(a,"function")||(a={});b<c;++b)if(null!=(d=arguments[b]))for(var h in d){var q=a[h],g=d[h];a!==g&&(e&&g&&p.lib.validate(g,"object")&&!g.nodeType?a[h]=p.lib.extend(e,q||(null!=g.length?[]:{}),g):p.lib.validate(g,"undefined")||(a[h]=g))}return a},template:function(a,b){var c;if(a){b||(b={});
a=a.toString();var e=a.split("|");for(var d=e.length,h=d-1;-1<h;h--)if(c=e[h]){a=!0;var q=c.split("{");for(var g=1,m=q.length;g<m;g++){var k=q[g];var n=k.indexOf("}");if(~n){var f=k.substr(0,n);c=b;var p=f.split(".");for(var t=0,r=p.length;a&&t<r;t++)f=p[t],(a=f in c)&&(c=c[f]);a&&(n+=1,k=c+k.substr(n))}else k="{"+k;q[g]=k}c=q.join("");a?e[h]=c:e.splice(h,1)}else h&&h<d-1&&(e[h]="|");b=e.join("")}else b="";return b},getRandomString:function(a,b){var c="";b||(b=89);b=Math.min(Math.max(b,1),89);for(var e=
0;e<a;e++)c+="0123456789abcdefghijklmnopqrstuvwxyzABCDEFGHIJKLMNOPQRSTUVWXYZ!@#$%^&*()-_+=;:,./?|`~[]{}".charAt(Math.round(Math.random()*(b-1)));return c}}})(App.prototype);

// 0.1.2 функци для работы в среде windows script host
(function(q,t,u){q.wsh={getLDAP:function(b,d,f,a,g){var m=[],n=[],c=0;if(!c){var e=new ActiveXObject("ADODB.Connection");var r=new ActiveXObject("NameTranslate");var h=new ActiveXObject("ADODB.Command")}c||(e.provider="ADsDSOObject",a&&(e.properties("User ID").value=a),g&&(e.properties("Password").value=g),e.open("Active Directory Provider"),h.activeConnection=e,h.properties("Searchscope").value=2,h.properties("Page Size").value=100);if(!c)if(f)var l=f;else f=GetObject("LDAP://RootDSE"),l=f.get("DefaultNamingContext");
c||(n=[b],d&&n.push(d));for(g=n.length-1;!c&&-1<g;g--){b=n[g];d=f=null;e="SELECT distinguishedName FROM 'LDAP://"+l+"'";if(!c&&b&&!d&&q.lib.validate(b,"guid")){a=(""+b).toUpperCase();try{r.init(3,""),r.set(7,a),d=r.get(1)}catch(p){c=1}}if(!c&&b&&!d)try{(d=b.get("distinguishedName"))&&(f=b)}catch(p){}if(!c&&b&&!d){a=e+" WHERE name = '"+b+"' OR sAMAccountName = '"+b+"' OR distinguishedName = '"+b+"'";try{h.commandText=a;var k=h.execute();k.recordCount&&(d=k.fields("distinguishedName").value)}catch(p){}}if(!c&&
!d){b?(a=""+b,a=q.lib.template(a,{protocol:"LDAP:",parent:l,select:e}),a.toUpperCase().indexOf("WHERE")?a.toUpperCase().indexOf("SELECT")&&(c=2):a=e+" "+a):a=g?e+" WHERE distinguishedName = '"+l+"'":e;try{h.commandText=a,k=h.execute(),k.recordCount||(c=4)}catch(p){c=3}}if(!c&&d&&!g)if(f)m.push(f);else{a=d;try{f=GetObject("LDAP://"+a),m.push(f)}catch(p){c=5}}if(!c&&!d)for(b=0,e=k.recordCount;b<e;k.moveNext(),b++)a=k.fields("distinguishedName").value,b||(d=a),!g&&b&&(f=GetObject("LDAP://"+a),m.push(f));
c||(l=d)}return m}}})(App.prototype,WSH);

// 0.1.1d взаимодействие с redmine по средствам api
var readmine=new App({apiKey:null,apiUrl:null,delimVal:":",delimKey:";",delimId:".",delimFormat:"#",stActive:1,stRegistered:2,stLocked:3});
(function(c,q,y){c.lib.extend(c,{cache:{user:{}},fun:{str2val:function(a){switch(!0){case "true"==a:a=!0;break;case "false"==a:a=!1;break;case !isNaN(a):a=Number(a);break;case "--"==a.charAt(4)+a.charAt(7)&&"::"==a.charAt(13)+a.charAt(16)&&"TZ"==a.charAt(10)+a.charAt(19):a=Date.UTC(Number(a.substr(0,4)),Number(a.substr(5,2)),Number(a.substr(8,2)),Number(a.substr(11,2)),Number(a.substr(14,2)),Number(a.substr(17,2))),a=new Date(a)}return a},val2str:function(a){switch(!0){case c.lib.validate(a,"string"):case c.lib.validate(a,
"number"):a=""+a;break;case c.lib.validate(a,"boolean"):a=a?"true":"false";break;case c.lib.validate(a,"date"):a=a.getUTCFullYear()+"-"+c.lib.strPad(a.getUTCMonth(),2,"0","left")+"-"+c.lib.strPad(a.getUTCDate(),2,"0","left")+"T"+c.lib.strPad(a.getUTCHours(),2,"0","left")+":"+c.lib.strPad(a.getUTCMinutes(),2,"0","left")+":"+c.lib.strPad(a.getUTCSeconds(),2,"0","left")+"Z";break;default:a=null}return a},xml2obj:function(a){var b={},e=null,g=!0;if(a){var f=a.documentElement?a.documentElement:a;for(var h=
0,d=f.attributes.length;h<d;h++){var l=f.attributes[h];g=!1;"type"!=l.name&&"array"!=l.value?b[l.name]=c.fun.str2val(l.value):a.documentElement||(e=!0)}e&&(b=[]);h=0;for(d=a.childNodes.length;h<d;h++)switch(f=a.childNodes[h],f.nodeType){case 1:g=!1;l=c.fun.xml2obj(f);e?b.push(l):b[f.nodeName]=l;break;case 3:g=!1,b=c.fun.str2val(f.nodeValue)}}else g=!1;return g?null:b},obj2xml:function(a,b){var e="item",g=null,f=null;var h={custom_fields:"custom_field",memberships:"membership",groups:"group",issues:"issue",
users:"user",roles:"role"};if(b)b.ownerDocument&&(g=b.ownerDocument);else{var d=["MSXML2.DOMDocument.6.0","MSXML2.DOMDocument.3.0","MSXML2.DOMDocument"];for(var l=0,m=d.length;!g&&l<m;l++){var k=d[l];try{g=new ActiveXObject(k)}catch(r){}}d=g.createProcessingInstruction("xml",'version="1.0" encoding="UTF-8"');g.appendChild(d)}if(g){f=g.createDocumentFragment();if(c.lib.validate(a,"array"))for(b&&(b.setAttribute("type","array"),d=b.nodeName,e=h[d]?h[d]:e),l=0,m=a.length;l<m;l++){var n=g.createElement(e);
for(var p in a[l])switch(k=a[l][p],d=c.fun.val2str(k),!0){case "value"==p&&"custom_field"==e:case "membership"==e:case "user"==e:d=k,k={},k[p]=d;case !d:d=c.fun.obj2xml(k,n);n.appendChild(d);break;default:n.setAttribute(p,d)}f.appendChild(n)}if(c.lib.validate(a,"object")){b&&(e=b.nodeName);for(p in a)switch(k=a[p],d=c.fun.val2str(k),!0){case !!d&&"project"==e:case !!d&&"tracker"==e:case !!d&&"priority"==e:case !!d&&"author"==e:case !!d&&"category"==e:b&&b.setAttribute(p,d);break;case !!b||!n&&!d:n=
g.createElement(p),d=d?g.createTextNode(d):c.fun.obj2xml(k,n),n.appendChild(d),f.appendChild(n)}if(!b&&n)for(p in a)k=a[p],(d=c.fun.val2str(k))&&n.setAttribute(p,d)}b||g.appendChild(f)}return b?f:g},item2user:function(a,b){var e,g,f={};(g=0,a)||(g=1);g||b||(g=2);if(!g){var h=a.get("userAccountControl");f.status=h&2?c.val.stLocked:c.val.stActive;var d=a.get("distinguishedName");c.cache.user[d]=f}if(!g)for(var l in b){g=b[l];h="";try{h=a.get(g.name)}catch(k){}g.format&&(h=c.fun.format(g.format,h));
switch(g.name){case "manager":var m=null;h&&h!=d&&(m=c.cache.user[h],!m&&(e=c.wsh.getLDAP(h)[0]))&&(m=c.fun.item2user(e,b),c.cache.user[h]=m);h="";if(e=m&&c.val.stActive==m.status)switch(g.format){case "firstname_lastname":h=[m.firstname,m.lastname].join(" ");break;case "firstname_lastinitial":h=[m.firstname,m.lastname.charAt(0)+"."].join(" ");break;case "firstinitial_lastname":h=[m.firstname.charAt(0)+".",m.lastname].join(" ");break;case "firstname":h=m.firstname;break;case "lastnamefirstname":h=
[m.lastname,m.firstname].join("");break;case "lastname_comma_firstname":h=[m.lastname,m.firstname].join(", ");break;case "lastname":h=m.lastname;break;case "username":h=m.login;break;default:h=[m.lastname,m.firstname].join(" ")}}isNaN(l)?f[l]=h:(f.custom_fields||(f.custom_fields=[]),f.custom_fields.push({id:l,value:h}))}return f},format:function(a,b){a=a?(""+a).toLowerCase():"";switch(a){case "phone":b=b?c.lib.trim(""+b):"";b=b.replace(/\D/g,"");!b.indexOf("8")&&10<b.length&&(b="7"+b.substr(1));var e=
[{position:0,length:b.length-10},{position:b.length-10,length:3},{position:b.length-7,length:3},{position:b.length-4,length:2},{position:b.length-2,length:2}];for(var g=0,f=e.length;g<f;g++)a=e[g].length+Math.min(0,e[g].position),e[g]=b.substr(Math.max(0,e[g].position),Math.max(0,a));!e[0]&&e[1]&&(e[0]=7);b=e[0]?"+"+e[0]:"";b+=e[1]?" ("+e[1]+") ":"";b+=e[2]?e[2]+"-":"";b+=e[3]?e[3]+(e[2]?"-":""):"";b+=e[4]?e[4]:"";break;default:b=""}return b}},method:{"users.sync":function(a,b,e){var g,f={},h=0,d=
0;if(!d){a=a?c.lib.str2obj(a,!1,c.val.delimKey,c.val.delimVal):{};for(p in a){var l=a[p].split("'").join("");l={name:l.split(c.val.delimFormat)[0],format:l.split(c.val.delimFormat)[1]};a[p]=l}var m=!0;var k=["login","firstname","lastname","mail"];l=0;for(var n=k.length;m&&l<n;l++){var p=k[l];m=m&&a[p]&&a[p].name}m||(d=1)}d||(g=c.wsh.getLDAP("WHERE 'objectClass' = 'user' AND '"+a.firstname.name+"' = '*' AND '"+a.lastname.name+"' = '*' AND '"+a.login.name+"' = '*' AND '"+a.mail.name+"' = '*'",b));l=
0;for(n=g.length;!d&&l<n;l++)if(b=g[l],k=c.fun.item2user(b,a),k.login){var r=k.login.toLowerCase();f[r]=k}else d=2;k=[c.val.stActive,c.val.stRegistered,c.val.stLocked];g=[];l=0;for(n=k.length;!d&&l<n;l++)for(p=k[l],a=null;!a||a.total_count>a.offset;a.offset+=a.limit){a={offset:a?a.offset:0,status:p};a=c.api("get","users",a);a.users||(a.users=[]);m=0;for(var q=a.users.length;m<q;m++)b=a.users[m],b.status=p,g.push(b)}d||g.length||(d=3);l=0;for(n=g.length;!d&&l<n;l++)if(b=g[l],r=b.login.toLowerCase(),
k=f[r]){if(k=c.lib.difference(k,b,function(a,b){return a.id==b.id&&a.value!=b.value}))e&&(k.auth_source_id=e),a={user:k},a=c.api("put","users/"+b.id,a),a.user&&h++;delete f[r]}if(!d)for(r in f)k=f[r],c.val.stActive==k.status&&(e&&(k.auth_source_id=e),a={user:k},a=c.api("post","users",a),a.user&&h++),delete f[r];return h},"issues.change":function(a,b,e){var g,f,h=0,d=0;var l={project:"project_id",tracker:"tracker_id",status:"status_id",priority:"priority_id",author:"author_id",assigned:"assigned_to_id",
category:"category_id",start:"start_date",due:"due_date",done:"done_ratio",private:"is_private",estimated:"estimated_hours",version:"fixed_version_id",parent:"parent_issue_id"};var m={start:"start_date",due:"due_date",done:"done_ratio",private:"is_private",estimated:"estimated_hours",created:"created_on",updated:"updated_on",closed:"closed_on"};if(!d)if(b=b?c.lib.str2obj(b,!1,c.val.delimKey,c.val.delimVal):null)for(var k in b){var n=b[k].split('"').join("");b[k]=c.fun.str2val(n)}else d=1;if(!d&&(e=
e?c.lib.str2obj(e,!1,c.val.delimKey,c.val.delimVal):null))for(k in e)n=e[k].split('"').join(""),e[k]=c.fun.str2val(n);if(!d){var p=[];for(f=null;!f||f.total_count>f.offset;f.offset+=f.limit)f={offset:f?f.offset:0},a&&(f.query_id=a),f=c.api("get","issues",f),f.issues&&(p=p.concat(f.issues))}for(var r=0,q=p.length;!d&&r<q;r++){var v=p[r];for(g in v){var t=v[g];(g=m[g]?m[g]:null)&&(v[g]=t)}var u=!0;if(e)for(k in e){a=e[k];if(isNaN(k))for(n=f=v,list=k.split(c.val.delimId),w=0,x=list.length;u&&w<x;w++)g=
list[w],(u=g in f)&&(n=f=f[g]);else{u=!1;list=v.custom_fields?v.custom_fields:[];for(var w=0,x=list.length;!u&&w<x;w++)if(t=list[w],u=t.id==Number(k))n=t.value}u&&(c.lib.validate(a,"string")&&(a=c.lib.template(a,v)),u=!c.lib.compare(n,a),u||(a=""+a,n=""+n,a=a.toLowerCase(),u=~n.toLowerCase().indexOf(a)));if(!u)break}if(u)for(k in t=null,b)n=b[k],c.lib.validate(n,"string")&&(n=c.lib.template(n,v)),k=l[k]?l[k]:k,t||(t={}),isNaN(k)?t[k]=n:(t.custom_fields||(t.custom_fields=[]),t.custom_fields.push({id:k,
value:n}));u&&(f={issue:t},f=c.api("put","issues/"+v.id,f),f.issue&&h++)}return h}},api:function(a,b,e){var g={},f=0;if(!f)switch(a.toLowerCase()){case "get":var h=!1;break;case "head":h=!1;break;case "delete":h=!1;break;default:h=!0}!f&&e&&h&&((e=c.fun.obj2xml(e))||(f=1));if(!f){b=c.val.apiUrl+b+".xml";var d={"Cache-Control":"no-store","If-None-Match":"empty"};c.val.apiKey&&(d["X-Redmine-API-Key"]=c.val.apiKey);d=c.lib.sjax(a,b,d,e);e=d.responseXML;c.lib.validate(e,"xml")||(f=2)}f||(e=c.fun.xml2obj(d.responseXML))&&
(g=e);return g},init:function(){var a,b,e,g=[],f=0,h=0,d=0;d||(h<q.arguments.length?(a=q.arguments(h))?((b="/"!=a.substr(a.length-1))&&(a+="/"),c.val.apiUrl=a):d=2:d=1,h++);d||(h<q.arguments.length?(a=q.arguments(h))?c.val.apiKey=a:d=4:d=3,h++);d||(h<q.arguments.length?(a=q.arguments(h),(e=c.method[a])||(d=6)):d=5,h++);if(!d)for(b=h,h=q.arguments.length;b<h;b++)a=q.arguments(b),g.push(a);d||(f=e.apply(c,g));q.quit(d?-1*d:f)}})})(readmine,WSH);readmine.init();
